<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_expense_approval_request_form" model="ir.ui.view">
        <field name="name">expense.approval.request.form</field>
        <field name="model">expense.approval.request</field>
        <field name="arch" type="xml">
            <form string="Expense Approval Request">
                <header>
                    <button name="action_submit" string="إرسال للموافقة" type="object"
                            class="btn-primary" attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_approve" string="اعتماد" type="object"
                            class="btn-success" attrs="{'invisible': [('can_approve', '=', False)]}"/>
                    <button name="action_reject" string="رفض" type="object"
                            class="btn-danger" attrs="{'invisible': [('can_approve', '=', False)]}"/>
                    <button name="action_set_to_draft"
                            string="Set to Draft"
                            type="object"
                            class="btn-secondary"
                            attrs="{'invisible': [('state', '!=', 'rejected')]}"/>
                    <button name="action_open_register_payment_wizard"
                            string="Register Payment"
                            type="object"
                            class="btn-primary"
                            groups="expense_approval.group_account_expense_approval"
                            attrs="{'invisible': [('state', '!=', 'approved')]}"/>

                    <button name="action_create_bill"
                            string="Create Bill"
                            type="object"
                            class="btn-primary"
                            attrs="{'invisible': [('state', '!=', 'approved')]}"
                            groups="expense_approval.group_account_expense_approval"/>

                    <button name="action_journal_entry"
                            string="Create Journal Entry"
                            type="object"
                            class="btn-primary"
                            attrs="{'invisible': [('state', '!=', 'approved')]}"
                            groups="expense_approval.group_account_expense_approval"/>


                    <field name="state" widget="statusbar" options="{'clickable': '1'}"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_payment"
                                type="object"
                                attrs="{'invisible': [('payment_count', '=', 0)]}"
                                class="oe_stat_button"
                                icon="fa-money">
                            <field name="payment_count" widget="statinfo" string="Payments"/>
                        </button>
                        <button class="oe_stat_button"
                                attrs="{'invisible': [('bill_count', '=', 0)]}"
                                name="action_view_bill" type="object" icon="fa-bars">
                            <field string="Bills" name="bill_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button"
                                attrs="{'invisible': [('journal_entry_count', '=', 0)]}"
                                name="action_view_journal_entry" type="object" icon="fa-bars">
                            <field string="Journal Entry" name="journal_entry_count" widget="statinfo"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="date" readonly="1"/>
                            <field name="department_id"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   options="{'no_create_edit': True}"/>
                            <field name="main_item_id"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   options="{'no_create_edit': True}"/>
                            <field name="sub_item_id"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   options="{'no_create_edit': True}"/>
                            <field name="expected_transfer_date"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   required="1"/>
                            <field name="partner_id"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   force_save="1"/>
                            <field name="acc_number"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   force_save="1"/>
                            <field name="actual_transfer_date" readonly="1"/>
                        </group>
                        <group>
                            <field name="amount"/>
                            <field name="budget_line_id" readonly="1"/>
                            <field name="planned_amount"/>
                            <field name="used_amount"/>
                            <field name="remaining_amount"/>
                            <field name="attachments_ids" widget="many2many_binary"/>
                            <field name="description"/>
                            <field name="can_approve" invisible="1"/>
                            <field name="has_product" invisible="1"/>
                            <field name="can_approve_store" invisible="1"/>
                            <field name="has_approved_before" invisible="1"/>
                            <field name="has_approved_before_stored" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="خطوات الموافقة">
                            <field name="approval_line_ids">
                                <tree editable="bottom" create="0" delete="0">
                                    <field name="sequence" invisible="1"/>
                                    <field name="level_name" readonly="1"/>
                                    <field name="user_id" readonly="1"/>
                                    <field name="state" readonly="1"/>
                                    <field name="approval_date" readonly="1"/>
                                    <field name="comment"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Products">
                            <field name="product_line_ids">
                                <tree editable="bottom">
                                    <field name="product_id"
                                           attrs="{'invisible': [('parent.has_product', '=', False)],'required': [('parent.has_product', '=', True)]}"
                                    />
                                    <field name="description"/>
                                    <field name="quantity"/>
                                    <field name="unit_price"/>
                                    <field name="discount_amount"/>
                                    <field name="discount_percent"/>
                                    <field name="tax_id"/>
                                    <field name="tax_amount" invisible="1"/>
                                    <field name="subtotal"/>
                                </tree>
                            </field>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="request_total">
                                <field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                    <label for="amount_total"/>
                                </div>
                                <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="paid_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="remaining_amount_total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>


    <record id="view_expense_approval_request_tree" model="ir.ui.view">
        <field name="name">expense.approval.request.tree</field>
        <field name="model">expense.approval.request</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="date"/>
                <field name="department_id"/>
                <field name="main_item_id"/>
                <field name="sub_item_id"/>
                <field name="amount"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_expense_approval_request_search" model="ir.ui.view">
        <field name="name">expense.approval.request.search</field>
        <field name="model">expense.approval.request</field>
        <field name="arch" type="xml">
            <search string="بحث طلبات الموافقة">
                <field name="name"/>

                <group expand="0" string="تجميع">
                    <filter name="group_by_can_approve"
                            string="لم يتم الموافقة"
                            domain="[('can_approve_store', '=', True)]"/>
                    <filter name="group_by_has_approved"
                            string="تمت الموافقة"
                            domain="[('has_approved_before_stored', '=', True)]"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_expense_approval_request" model="ir.actions.act_window">
        <field name="name">Expense Approval Requests</field>
        <field name="res_model">expense.approval.request</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p>أنشئ طلب تعميد جديد من هنا</p>
        </field>
    </record>

    <record id="action_my_expense_requests" model="ir.actions.act_window">
        <field name="name">طلبات الموافقه الخاصة بي</field>
        <field name="res_model">expense.approval.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'create': False}</field>
        <field name="domain">
            ['|',
            ('can_approve_store', '=', True),
            ('has_approved_before_stored', '=', True)
            ]
        </field>


    </record>

    <menuitem id="menu_my_expense_requests"
              name="طلبات الموافقه الخاصة بي"
              parent="expense_approval.menu_expense_approval"
              action="action_my_expense_requests"
              sequence="7"/>

    <menuitem id="menu_expense_approval_requests"
              name="طلبات التعميد"
              parent="expense_approval.menu_expense_approval"
              action="action_expense_approval_request"
              sequence="6"/>


</odoo>